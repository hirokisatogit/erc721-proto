<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <link href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="signIn.css" />
  </head>

  <body>
    <h1 class="title">
      Image Guardian
    </h1>
    <div id="firebaseui-auth-container"></div>
    <!-- <script src="/__/firebase/7.16.0/firebase-app.js"></script> -->
    <script src="/__/firebase/7.16.0/firebase-auth.js"></script>
    <script src="/__/firebase/init.js"></script> 
    <script src="./config.js"></script>
    <script type="text/javascript">

  const ui = new firebaseui.auth.AuthUI(firebase.auth());
  const uiConfig = {
  callbacks: {
    signInSuccessWithAuthResult: function(authResult, redirectUrl) {
      return true;
    },
  },
  signInFlow: 'popup',
  signInSuccessUrl: 'signIn.html',
  signInOptions: [
    firebase.auth.GoogleAuthProvider.PROVIDER_ID,
  ],
  tosUrl: 'index.vue',
  privacyPolicyUrl: 'signIn.html'
  };

  ui.start('#firebaseui-auth-container', uiConfig);

  firebase.auth().onAuthStateChanged(user => {
    if (user) {
        const signOutMessage = `
        <p>Hello, ${user.displayName}!<\/p>
        <button type="submit"  onClick="signOut()">サインアウト<\/button>
        `;
        document.getElementById('auth').innerHTML =  signOutMessage;
        console.log('ログインしています');

    } 
  });
 // サインアウトボタンが必要なはず
  function signOut() {
  firebase.auth().onAuthStateChanged(user => {
    firebase
      .auth()
      .signOut()
      .then(() => {
        console.log('ログアウトしました');
        location.reload();
      })
      .catch((error) => {
        console.log(`ログアウト時にエラーが発生しました (${error})`);
      });
  });
  }
  // Firebase Authentication のPromiseオブジェクトを生成する関数を定義
  function genUser() {
    return new Promise((resolve, reject) => {
      firebase.auth().onAuthStateChanged(user => {
        if (user) {
          resolve(user);
        } else {
          return null;
        }
      });
    });
  }
// Firebase の認証情報をResolveして処理ロジックに渡す
    Promise.resolve(genUser()).then(user =>{
    // user 内にGoogle認証を利用したユーザー情報が格納されている
    console.log(user.uid);
    console.log(user.displayName);

    });
  </script>
</body>
</html>